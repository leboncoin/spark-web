#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Get the branch being pushed to
branch=$(git symbolic-ref --short HEAD 2>/dev/null || echo "")

# Only check if pushing to main
if [ "$branch" = "main" ] || [ "$1" = "main" ]; then
  # Check if lerna.json contains a beta version
  if grep -q '"-beta\.[0-9]\+"' lerna.json 2>/dev/null || grep -E '"(alpha|beta|rc)\.[0-9]+"' lerna.json 2>/dev/null; then
    echo "❌ ERROR: lerna.json contains a prerelease version on main branch!"
    echo "   Prerelease versions (alpha, beta, rc) should never be committed to main."
    echo "   Please update lerna.json to use a stable version."
    exit 1
  fi
  
  # Also check all package.json files in packages/
  if find packages -name "package.json" -type f -exec grep -lE '"(alpha|beta|rc)\.[0-9]+"' {} \; 2>/dev/null | grep -q .; then
    echo "❌ ERROR: One or more package.json files contain a prerelease version on main branch!"
    echo "   Prerelease versions should never be committed to main."
    echo "   Please update all package.json files to use stable versions."
    exit 1
  fi
fi

