import { Meta, Canvas, ArgTypes } from '@storybook/addon-docs/blocks'
import { A11yReport } from '@docs/helpers/A11yReport'
import { AriaRoles } from '@docs/helpers/AriaRoles'
import { Callout } from '@docs/helpers/Callout'
import { Kbd } from '../kbd'
import { FileUpload } from '.'

import * as stories from './FileUpload.stories'

<Meta of={stories} />

# FileUpload

A file upload component that provides a flexible way to handle file selection, drag-and-drop functionality, and file previews. The component supports both simple button triggers and dropzone interfaces with customizable file rendering.
<Canvas of={stories.Default} />

## Install

```sh
npm install @spark-ui/components
```

## Anatomy

```tsx
import { FileUpload } from "@spark-ui/components/file-upload"

export default () => (
  <FileUpload>
    <FileUpload.Trigger>
      Upload Files
    </FileUpload.Trigger>
    <FileUpload.FilesPreview />
  </FileUpload>
);
```



## API Reference

### FileUpload

Contains all the parts of a file upload.

<ArgTypes of={FileUpload} />

### _.Trigger

Triggers the file selection dialog when clicked. Can be styled as a button or rendered as any component using the `asChild` prop.

<ArgTypes of={FileUpload.Trigger} />


## Examples


### Acepted files - custom

Use the `render` prop of `FileUpload.FilesPreview` to customize the markup of the files previews.

<Canvas of={stories.WithCustomFileRender} />

### With default files

Use the `defaultValue` prop to initialize the component with existing files. This is useful when editing a form with previously uploaded files or when restoring files from a saved state.

<Canvas of={stories.WithDefaultFiles} />

### Single file

Use the `multiple={false}` prop to allow only a single file to be selected. When a new file is selected, it will replace the existing file.

<Canvas of={stories.SingleFile} />

### Accept file types

Use the `accept` prop to restrict the types of files that can be selected. The prop supports:
- MIME type wildcards (e.g., `"image/*"` for all images)
- Exact MIME types (e.g., `"image/png"`, `"application/pdf"`)
- File extensions (e.g., `".pdf"`, `".doc"`, `".jpg"`)
- Mixed patterns (e.g., `"image/*,.pdf,.doc"`)

Files that don't match the accept pattern will be automatically filtered out.

<Canvas of={stories.AcceptDocuments} />

### Maximum files

Use the `maxFiles` prop to limit the number of files that can be uploaded. When the limit is reached, additional files will be rejected. You can use the `onMaxFilesReached` callback to handle this case and display an error message.

<Canvas of={stories.MaxFiles} />

### File size limits

Use the `maxFileSize` and `minFileSize` props to restrict the size of files that can be uploaded. File sizes are specified in bytes. Files that don't meet the size requirements will be automatically filtered out. You can use the `onFileSizeError` callback to handle size validation errors and display specific error messages for each rejected file.

<Canvas of={stories.FileSizeLimit} />

### Disabled state

Use the `disabled` prop to prevent user interaction with the file upload component. When disabled, users cannot add, remove, or modify files. The component is visually disabled with reduced opacity and a "not-allowed" cursor. Existing files are still displayed but cannot be modified. Disabled fields do not participate in form submission.

<Canvas of={stories.Disabled} />

### Read-only state

Use the `readOnly` prop to set the file upload to read-only mode. Similar to disabled, users cannot add, remove, or modify files, but the component maintains a more subtle visual appearance (no opacity reduction). Existing files are displayed but cannot be modified. Read-only fields participate in form submission.

<Canvas of={stories.ReadOnly} />

## Advanced examples

### Custom Trigger

Use `unstyled` on the `FileUpload.Trigger` and wrap it with a Spark UI component compatible with the `asChild` prop to render the button as a different component.

<Callout kind="warning" marginY="large">
  <p>
    a11y: It is important that the trigger remain a button (with `type="button"`) and that it is focusable and clickable.
  </p>
</Callout>

<Canvas of={stories.CustomTrigger} />

### Custom Dropzone

Customize the dropzone appearance and behavior by wrapping it with other components or modifying its content. 

{/* <Canvas of={stories.Multiple} /> */}

### Photos Gallery

<Canvas of={stories.PhotosGallery} />

## Accessibility

<A11yReport of="file-upload" />

Adheres to the [file upload pattern](https://www.w3.org/WAI/ARIA/apg/patterns/file-upload/).

### Keyboard Interactions

- <kbd>Tab</kbd> - Navigate to the file upload trigger
- <kbd>Enter</kbd> or <kbd>Space</kbd> - Open file selection dialog
- <kbd>Escape</kbd> - Close file selection dialog

### Pattern

The FileUpload component uses a context-based architecture where the main component provides file management state and the sub-components handle specific functionality like triggering file selection and displaying file previews.

